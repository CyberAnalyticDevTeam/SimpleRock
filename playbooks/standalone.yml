---
- hosts: standalone

  pre_tasks:
    - name: Apply override settings, if available
      include_vars: /etc/rocknsm/config.yml

###Server Roles###
  roles:
    - common
    # Containerized_install: if true, all services are docker containers. Otherwise, services installed bare metal
    - { role: docker, when: containerized_install }
    - { role: elasticsearch, when: with_elasticsearch }
    - { role: logstash, when: with_logstash }
    - { role: kibana, when: with_kibana }
    - { role: nginx, when: with_nginx }
    - { role: portainer, when: containerized_install and with_portainer }


    # Harbor must run last so that it uploads all containers installed on the machine.
    - { role: harbor, when: containerized_install and with_harbor }

###Sensor Roles###
    - common_sensor
    - { role: suricata, when: with_suricata }
    - { role: kafka, when: with_kafka }
    - { role: zookeeper, when: with_zookeeper }
    - { role: filebeats, when: with_filebeats }
    - { role: bro, when: with_bro }

    # Containerized_install: if true, all services are docker containers. Otherwise, services installed bare metal
    - { role: docker, when: containerized_install }
